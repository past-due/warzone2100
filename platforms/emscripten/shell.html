<!doctype html>
<html lang="en" class="h-100" data-bs-theme="auto">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="pastdue, and Warzone 2100 Project contributors">
    <title>Warzone 2100 - Web Edition</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" integrity="sha512-b2QcS5SsA8tZodcDtGRELiGv5SaKSk1vDHDaQRda0htPYWZ6046lr3kJ5bAAQdpV2mmA/4v0wQF9MyU6/pDIAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" integrity="sha512-dPXYcDub/aeb08c63jRq/k6GaKccl256JQy/AnOq7CAnEZ9FzSL9wSbcZkMp4R26vBsMLFYH4kQ67/bbV8XaCQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Favicons -->  
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Warzone 2100">
    <meta name="application-name" content="Warzone 2100">
    <meta name="theme-color" content="#000000">


    <style>
      body {
        margin: 0;
        padding: 0;
        min-width: 480px;
        min-height: 640px;
        overflow: hidden;
        text-shadow: 0 .05rem .1rem rgba(0, 0, 0, .5);
        box-shadow: inset 0 0 5rem rgba(0, 0, 0, .5);
      }
      .cover-container {
        max-width: 42em;
      }
      
      .options-link {
        color: rgba(255, 255, 255, .5);
        text-decoration: none;
      }
      .options-link:hover{
        text-decoration: underline!important;
      }
      
      .nav-masthead .nav-link {
        color: rgba(255, 255, 255, .5);
        border-bottom: .25rem solid transparent;
      }

      .nav-masthead .nav-link:hover,
      .nav-masthead .nav-link:focus {
        border-bottom-color: rgba(255, 255, 255, .25);
      }

      .nav-masthead .nav-link + .nav-link {
        margin-left: 1rem;
      }

      .nav-masthead .active {
        color: #fff;
        border-bottom-color: #fff;
      }
      
      .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
      textarea.emscripten { font-family: monospace; width: 80%; }
      div.emscripten { text-align: center; color: rgb(148 163 184); }
      div.emscripten_container { border: 0px none; outline: none; position: absolute; top: 0;}
      /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
      canvas.emscripten { border: 0px none; padding: 0px; outline: none!important; }
      canvas.emscripten:focus { border-color: inherit; -webkit-box-shadow: none; box-shadow: none; }
      
      .web-edition-badge {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
        border-color: rgba(255,255,255,0.5)!important;
      }
      
      #gameloadingspinner {
      z-index: 999;
      position: absolute;
      display: none;
/*      width: 100px;
      height: 100px;*/
      }
      #gameloadingspinner .spin-figure-container {
      width: 100px;
      height: 100px;
      margin: 1em;
      }
      
      #gameloadingspinner .spin-loading-text {
        display: none;
      }
      
      .smaller {
        font-size: .75em;
      }
      
      .small-screen-blocker {
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         z-index: 100001;
         background: #000;
         color: #fff;
         text-align: center;
         display: none;
      }
      
      /* The device does not include any pointing device. */
      @media (any-pointer: none) {
        
      }
      
      @media (max-width: 640px) {
         .small-screen-blocker {
             display: block;
         }
      }
      
      @media (max-height: 480px) {
         .small-screen-blocker {
             display: block;
         }
      }
      
      @media all and (display-mode: standalone) {
          /* Here goes the CSS rules that will only apply if app is running standalone */
          .hide-on-standalone {
            display: none;
          }
          .show-on-standalone {
            display: block!important;
          }
      }
      
      .initial-load-spinner {
        position: relative;
        display: block;
        height: 100px;
        min-height: 100px;
      }
      
    </style>
    
    <style>
      /*
      CSS Loading Spinner (Modified for WZ)
      Original License:
      Copyright (c) 2022 by Martin van Driel (https://codepen.io/martinvd/pen/xbQJom)
      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. */

      .loader {
      position: absolute;
      top: calc(50% - 32px);
      left: calc(50% - 32px);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      perspective: 800px;
      }

      .inner {
      position: absolute;
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      }

      .inner.core {
      display: flex;
      align-items: center;
      justify-content: center;
      }

      .circle {
      width: 15%;
      height: 15%;
      border-radius: 50%;
      background-color: #EFEFFA;
      box-shadow:
        inset 0 0 5px #09ff00,
        inset 2px 0 8px #09ff00,
        inset -2px 0 8px #09ff00,
        inset 2px 0 30px #09ff00,
        inset -2px 0 30px #09ff00,
        0 0 50px #09ff00,
        -1px 0 8px #09ff00,
        1px 0 8px #09ff00;
      animation: pulseOpacity 2.5s infinite cubic-bezier(0.455, 0.03, 0.515, 0.955);
      }

      @keyframes pulseOpacity {
      0% {
        opacity: 1;
      }
      50% {
        opacity: .4;
      }
      100% {
        opacity: 1;
      }
      }

      .inner.one {
      left: 0%;
      top: 0%;
      animation: rotate-one 1s linear infinite;
      border-bottom: 3px solid #EFEFFA;
      }

      .inner.two {
      right: 0%;
      top: 0%;
      animation: rotate-two 1s linear infinite;
      border-right: 3px solid #EFEFFA;
      }

      .inner.three {
      right: 0%;
      bottom: 0%;
      animation: rotate-three 1s linear infinite;
      border-top: 3px solid #EFEFFA;
      }

      @keyframes rotate-one {
      0% {
        transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg);
      }
      100% {
        transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg);
      }
      }

      @keyframes rotate-two {
      0% {
        transform: rotateX(50deg) rotateY(10deg) rotateZ(0deg);
      }
      100% {
        transform: rotateX(50deg) rotateY(10deg) rotateZ(360deg);
      }
      }

      @keyframes rotate-three {
      0% {
        transform: rotateX(35deg) rotateY(55deg) rotateZ(0deg);
      }
      100% {
        transform: rotateX(35deg) rotateY(55deg) rotateZ(360deg);
      }
      }
    </style>
  </head>
  <body class="d-flex text-center text-bg-dark">
  <div id="gameloadingspinner">
    <figure style="overflow:visible;" class="spin-figure-container">
      <div class="loader">
      <div class="inner core"><div class="circle"></div></div>
      <div class="inner one"></div>
      <div class="inner two"></div>
      <div class="inner three"></div>
      </div>
    </figure>
    <span class="spin-loading-text" id="spin-loading-text">Loading ...</span>
  </div>

<div class="w-100 vh-100" id="content_container">
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
  <header class="mb-auto">
    <div>
      <span class="h3 float-md-start mb-0">Warzone 2100 <span class="web-edition-badge d-inline-flex mb-3 px-2 py-1 fw-semibold border rounded-2 align-middle">Web Edition</span></span>
      <nav class="nav nav-masthead justify-content-center float-md-end">
        <a class="nav-link fw-bold py-1 px-0 hide-on-standalone" href="https://wz2100.net" target="_blank" rel="noopener">Get the Full Version</a>
        <a class="nav-link fw-bold py-1 px-0 d-none show-on-standalone" data-bs-toggle="modal" data-bs-target="#launchOptions" href="#"><i class="bi bi-gear pe-1"></i>Options</a>
        <a class="nav-link fw-bold py-1 px-0" title="Donate" href="https://donations.wz2100.net" target="_blank" rel="noopener"><i class="bi bi-heart pe-1"></i>Donate</a>
        <a class="nav-link fw-bold py-1 px-0" title="Discord Server" href="https://discord.com/invite/ZvRVQ8g" target="_blank" rel="noopener"><i class="bi bi-discord"></i></a>
      </nav>
    </div>
  </header>

  <noscript>
  <main class="px-3">
    <h1>Javascript is disabled</h1>
    <p class="lead">The web edition of Warzone 2100 requires Javascript to be enabled</p>
    <p class="text-white" style="--bs-text-opacity: .5;">Please enable Javascript and refresh your browser to continue.</p>
  </main>
  </noscript>
  
  <main class="px-3" style="display: none;" id="unsupported-browser">
    <h1>Unsupported Browser</h1>
    <p>Unfortunately, your browser does not support the Web Edition of Warzone 2100</p>
    <p class="lead">:-(</p>
    <p class="">Please try updating to the latest version of a supported browser<br/>(ex. Chrome, Edge, Firefox, or Safari).</p>
    <p class="text-white" style="--bs-text-opacity: .5;">Missing or disabled features: <span id="missing-features">WebAssembly, WebGL 2</span></p>
  </main>

  <main class="px-3" style="display: none;" id="launch-game">
    <h1>Launch the Web Edition</h1>
    <p class="lead"><i class="bi bi-check-circle pe-1"></i>Classic look, <i class="bi bi-check-circle pe-1"></i>Medium-quality textures, <i class="bi bi-check-circle pe-1"></i>Campaign &amp; skirmish</p>
    <p class="lead">
      <button type="button" class="btn btn-lg btn-primary fw-bold" id="start-button" onclick="startGame()">Play Now</button>
    </p>
    <p class="mb-0 text-white" style="--bs-text-opacity: .4;">If this is your first time, this will download approximately 60MiB of data.</p>
    <p class="pb-2 text-white small" style="--bs-text-opacity: .5;">Plays Best With: <i class="bi bi-mouse2 pe-1"></i><i class="bi bi-keyboard pe-1"></i>Mouse &amp; Keyboard<span class="px-2">|</span><a class="options-link" data-bs-toggle="modal" data-bs-target="#launchOptions" href="#"><i class="bi bi-gear pe-1"></i>Configure Options</a></p>
  </main>
  
  <main class="px-3" style="display: none;" id="loading-game">
    <h1>Loading ...</h1>
    <div class="emscripten" id="status"></div>
    <div class="emscripten" style="block-size: 1em;">
      <progress value="0" max="100" id="progress" hidden=1></progress>
    </div>
    <p class="lead">&nbsp;</p>
  </main>
  
  <div class="px-3 initial-load-spinner" id="initial-load-spinner">
      <figure style="overflow:visible;">
        <div class="loader">
        <div class="inner core"><div class="circle"></div></div>
        <div class="inner one"></div>
        <div class="inner two"></div>
        <div class="inner three"></div>
        </div>
      </figure>
  </div>
  
  <main class="px-3" style="display: none;" id="loading-error">
    <h1 class="mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-emoji-frown" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>
  <path d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.5 3.5 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.5 4.5 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5m4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5"></path>
</svg></h1>
    <p class="lead">An error occurred trying to load Warzone 2100.</p>
    <p class="mb-1">Please check your Internet connection, and reload to try again.</p>
    <p class="text-white" style="--bs-text-opacity: .5;">Error Message: <span id="loading-error-message"></span></p>
    <p class="lead">
      <button type="button" class="btn btn-lg btn-outline-secondary fw-bold" id="reload-err-button" onclick="window.location.reload();"><i class="bi bi-arrow-clockwise pe-1"></i>Reload</button>
    </p>
  </main>
  
  <main class="px-3" style="display: none;" id="post-exit">
    <h1>Thanks for playing!</h1>
    <p class="lead">If you'd like to play again, simply reload.</p>
    <p class="lead">
      <button type="button" class="btn btn-lg btn-outline-secondary fw-bold" id="reload-button" onclick="window.location.reload();"><i class="bi bi-arrow-clockwise pe-1"></i>Reload</button>
    </p>
    <p class="lead">Or help us out by donating:</p>
    <a class="btn btn-sm btn-outline-secondary btn-block" title="Donate" href="https://donations.wz2100.net" target="_blank" rel="noopener"><i class="bi bi-heart pe-1"></i>Donate</a>
  </main>

  <footer class="mt-auto text-white" style="--bs-text-opacity: .5;">
    <div id="footer">
      <div id="full-version-footer-notice" class="hide-on-standalone">
        <p class="lead">Or download the Full Version, with:<br /><small><i class="bi bi-badge-hd-fill pe-1"></i>HQ remastered graphics, <i class="bi bi-globe2 pe-1"></i>Online multiplayer, <i class="bi bi-speedometer pe-1"></i>Better performance</small></p>
        <p class="lead">
          <a href="https://wz2100.net" class="btn btn-sm btn-outline-primary">Download Warzone 2100</a>
        </p>
      </div>
    </div>
    <p class="smaller">Copyright Â© Warzone 2100 Project. Licensed under <a href="https://github.com/Warzone2100/warzone2100/blob/master/LICENSE" rel="noopener nofollow" data-target="_blank" target="_blank" hreflang="en" class="text-white" style="--bs-text-opacity: .5;">GPL-2.0-or-later</a>. <a href="https://github.com/Warzone2100/warzone2100" rel="noopener" data-target="_blank" target="_blank" class="text-white" style="--bs-text-opacity: .5;">Get the Source</a>.</p>
  </footer>
</div>
</div> <!-- content_container -->
  <div class="emscripten_container" id="emscripten_container" style="display:none;">
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js" integrity="sha512-X/YkDZyjTf4wyc2Vy16YGCPHwAY8rZJY+POgokZjQB2mhIRFJCckEGc6YyX9eNsPfn0PzThEuNs+uaomE5CO6A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <div class="small-screen-blocker">
      <main class="px-3 py-3">
        <h1>Too Small</h1>
        <p class="lead">Window / display is too small for Warzone 2100</p>
        <p class="">Required Minimum: 640x480</p>
      </main>
      <footer class="mt-auto text-white" style="--bs-text-opacity: .5;">
        <p class="hide-on-standalone">Or get the Full Desktop version, with high-resolution remastered graphics, online multiplayer, better performance, and more.</p>
        <p class="hide-on-standalone">
          <a href="https://wz2100.net" class="btn btn-sm btn-outline-primary">Download Warzone 2100</a>
        </p>
      </footer>
    </div>
    <!-- Launch Options Modal -->
    <div class="modal fade text-start" id="launchOptions" data-bs-backdrop="static" data-bs-keyboard="false" data-bs-theme="dark" tabindex="-1" aria-labelledby="launchOptionsLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="launchOptionsLabel">Launch Options</h1>
            <button type="button" class="btn-close" onclick="wz_dismiss_options_modal()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="optional-data-form">
              <label for="optional-data-form" class="form-label">Optional Data:</label>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="launchOption_loadMusic" checked>
                <label class="form-check-label" for="launchOption_loadMusic">Load Music</label>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="launchOption_loadClassicTerrain">
                <label class="form-check-label" for="launchOption_loadClassicTerrain">Load Classic Terrain Pack</label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="wz_dismiss_options_modal()">OK</button>
          </div>
        </div>
      </div>
    </div>
    <script type='text/javascript'>
    
    let WZ_LAUNCH_OPTIONS_MAPPING = {
      'load_music': 'launchOption_loadMusic',
      'load_classic_terrain': 'launchOption_loadClassicTerrain'
    }

    var WZ_CONFIG_DIR_SUFFIX = (() => {
      // Determine default config dir suffix based on window.location, to ensure that separate branches get separate config directories
      // If in root, no suffix. If in "/dev/", should be "-dev"
      var pathArray = window.location.pathname.split('/').filter(n => n);
      if (!window.location.pathname.endsWith('/') && pathArray.length > 0) {
        pathArray.pop();
      }
      let dirSuffix = pathArray.join('-');
      if (dirSuffix.length > 0) {
        return "-" + dirSuffix;
      }
      else {
        return "";
      }
    })();
    let WZ_DATA_FILES_URL_SUBDIR = (() => {
      return window.location.pathname.replace(/[^/]*$/, '');
    })();
    let WZ_DATA_FILES_URL_HOST = (() => {
      if (window.location.hostname == 'play.wz2100.net') {
        return 'https://data.'+window.location.hostname;
      } else {
        return null;
      }
    })();
    let WZ_VIDEO_SEQUENCES_BASE_URL = (() => {
      if (window.location.hostname == 'play.wz2100.net') {
        return 'https://data.play.wz2100.net/sequences/';
      } else {
        return 'sequences/'; // default is just relative to current path
      }
    })();
    let WZ_MUSIC_BASE_URL = (() => {
      if (window.location.hostname == 'play.wz2100.net') {
        return 'https://data.play.wz2100.net/music/';
      } else {
        return 'music/'; // default is just relative to current path
      }
    })();
    let WZ_DATA_TERRAIN_BASE_URL = (() => {
      if (window.location.hostname == 'play.wz2100.net') {
        return 'https://data.play.wz2100.net/terrain_overrides/';
      } else {
        return 'terrain_overrides/'; // default is just relative to current path
      }
    })();
    
    function storageAvailable(type) {
      let storage;
      try {
        storage = window[type];
        const x = "__storage_test__";
        storage.setItem(x, x);
        storage.removeItem(x);
        return true;
      } catch (e) {
        return (
          e instanceof DOMException &&
          // everything except Firefox
          (e.code === 22 ||
            // Firefox
            e.code === 1014 ||
            // test name field too, because code might not be present
            // everything except Firefox
            e.name === "QuotaExceededError" ||
            // Firefox
            e.name === "NS_ERROR_DOM_QUOTA_REACHED") &&
          // acknowledge QuotaExceededError only if there's something already stored
          storage &&
          storage.length !== 0
        );
      }
    }
    let LOCALSTORAGE_AVAILABLE = storageAvailable("localStorage");
    
    function wz_save_launch_options() {
      if (!LOCALSTORAGE_AVAILABLE) {
        console.log('localStorage is not available - launch options not persisted');
        return;
      }
      Object.entries(WZ_LAUNCH_OPTIONS_MAPPING).forEach(([k,v]) => {
        localStorage.setItem(k, document.getElementById(v)?.checked);
      })
    }
    
    function wz_restore_launch_options() {
      if (!LOCALSTORAGE_AVAILABLE) {
        console.log('localStorage is not available - launch options not restored');
        return;
      }
      Object.entries(WZ_LAUNCH_OPTIONS_MAPPING).forEach(([k,v]) => {
        let el = document.getElementById(v);
        if (!el) {
          return;
        }
        let checkedValue = localStorage.getItem(k);
        if (checkedValue !== null) {
          if (checkedValue && checkedValue !== "false") {
            el.checked = true;
          } else {
            el.checked = false;
          }
        }
      })
    }
    
    function wz_dismiss_options_modal() {
      wz_save_launch_options();
      const launchoptions_modal = document.querySelector('#launchOptions');
      const modal = bootstrap.Modal.getInstance(launchoptions_modal);
      modal.hide();
    }

    function wz_js_get_config_dir_suffix()
    {
      return WZ_CONFIG_DIR_SUFFIX;
    }
    
    function wz_display_loading_error(errorStr) {
      document.getElementById('loading-error').style.display = 'block';
      document.getElementById('loading-error-message').innerText = errorStr;
      document.getElementById('loading-game').style.display = 'none';
      wz_js_display_loading_indicator(0);
    }
    
    async function loadScriptAsync(url) {
      return new Promise((resolve, reject) => {
        const element = document.createElement('script');
        element.src = url;
        element.type = 'text/javascript';
        element.async = true;
        element.onload = () => resolve();
        element.onerror = () => reject();
        document.head.appendChild(element);
      });
    }

    function startGame() {
      // Make canvas visible
      document.getElementById('loading-game').style.display = 'block';
      document.getElementById('launch-game').style.display = 'none';
      document.getElementById('footer').style.display = 'none';
      // document.body.scrollTop = document.documentElement.scrollTop = 0;
      window.scroll({
        top: 0,
        left: 0,
        behavior: "instant",
      });
      // document.getElementById('emscripten_container').style.display = 'block';
      var startButton = document.getElementById('start-button');
      startButton.disabled = false;
      startButton.hidden = true;
      //document.body.style.background = 'black';
      wz_js_display_loading_indicator(1);
      // Execute main()
      function actuallyStartGame() {
        setTimeout( function() {
          createWZModule(Module).then(function(Module) {
            // this is reached when everything is ready, and you can call methods on Module
            // bring the canvas container to the very top
            // let canvasContainer = document.getElementById('emscripten_container');
            // canvasContainer.style.display = 'block';
            // canvasContainer.parentNode.appendChild(canvasContainer);
            document.getElementById('loading-game').style.display = 'none';
            // Since some browsers (i.e. Safari) won't show the spinner animation when WZ's main thread is blocked
            // Also display "Loading ..." text
            document.getElementById('spin-loading-text').style.display = 'inline-block';
          })
          .catch((error) => {
            // Failed to create / load
            console.error(error);
            wz_display_loading_error(error.message);
          });
        }, 10);
      }
      
      var WZ_LAUNCH_OPTIONS = {};
      Object.entries(WZ_LAUNCH_OPTIONS_MAPPING).forEach(([k,v]) => {
        WZ_LAUNCH_OPTIONS[k] = document.getElementById(v)?.checked;
      })
      wz_save_launch_options();
      var data_load_promises = [];
      
      // optional data file loads
      let start_optional_promises = data_load_promises.length;
      if (WZ_LAUNCH_OPTIONS['load_music']) {
        // music data file
        let musicJSURL = WZ_MUSIC_BASE_URL + 'warzone2100-music.js';
        data_load_promises.push(loadScriptAsync(musicJSURL));
      }
      if (WZ_LAUNCH_OPTIONS['load_classic_terrain']) {
        // classic terrain pack
        let terrainJSURL = WZ_DATA_TERRAIN_BASE_URL + 'warzone2100-terrain-classic.js';
        data_load_promises.push(loadScriptAsync(terrainJSURL));
      }
      
      Promise.allSettled(data_load_promises)
      .then((values) => {
        var failedRequiredLoad = false;
        for (let i = 0; i < values.length; i++) {
          if (values[i].status != 'fulfilled') {
            if (i < start_optional_promises) {
              // Failed a required promise
              console.error('Failed a required data-file load');
              failedRequiredLoad = true;
            }
          }
        }
        if (failedRequiredLoad) {
          console.error('Failed to load at least one required data file');
          return;
        }
        actuallyStartGame();
      });
    }
    
    function wz_js_display_loading_indicator(enabled) {
      var loadingElement = document.getElementById('gameloadingspinner');
      if (enabled) {
        loadingElement.style.display = 'inline';
      } else {
        loadingElement.style.display = 'none';
      }
    }
    function wz_js_display_canvas() {
      let canvasContainer = document.getElementById('emscripten_container');
      canvasContainer.style.display = 'block';
    }
    </script>
    <script>
      function displayUnsupportedBrowserMsg(missingFeatures) {
        document.getElementById('unsupported-browser').style.display = 'block';
        document.getElementById('missing-features').innerText = missingFeatures.join(', ');
        document.getElementById('initial-load-spinner').style.display = 'none';
      }
      function displayLaunchGameMsg() {
        document.getElementById('launch-game').style.display = 'block';
        document.getElementById('initial-load-spinner').style.display = 'none';
      }
      
      function isRunningStandalone() {
          return (window.matchMedia('(display-mode: standalone)').matches);
      }
      
      // Check browser support
      function wasmSupported() {
      try {
        if (typeof WebAssembly === "object" && typeof WebAssembly.instantiate === "function") {
          // Smallest possible WebAssembly module
          const module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
          if (module instanceof WebAssembly.Module)
            return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;
        }
      } catch (e) {
      }
      return false;
      }

      /* wasm-feature-detect
       https://github.com/GoogleChromeLabs/wasm-feature-detect
       License: License Apache-2.0 */
      !function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).wasmFeatureDetect=n()}(this,(function(){"use strict";return{bigInt:()=>(async e=>{try{return(await WebAssembly.instantiate(e)).instance.exports.b(BigInt(0))===BigInt(0)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,126,1,126,3,2,1,0,7,5,1,1,98,0,0,10,6,1,4,0,32,0,11])),bulkMemory:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),exceptions:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),extendedConst:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,5,3,1,0,1,11,9,1,0,65,1,65,2,106,11,0])),gc:()=>(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,95,1,120,0])))(),jspi:()=>(async()=>"Suspender"in WebAssembly)(),memory64:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,5,3,1,4,1])),multiMemory:()=>(async()=>{try{return new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,5,5,2,0,0,0,0])),!0}catch(e){return!1}})(),multiValue:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,0,2,127,127,3,2,1,0,10,8,1,6,0,65,0,65,0,11])),mutableGlobals:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,2,8,1,1,97,1,98,3,127,1,6,6,1,127,1,65,0,11,7,5,1,1,97,3,1])),referenceTypes:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,7,1,5,0,208,112,26,11])),relaxedSimd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,15,1,13,0,65,1,253,15,65,2,253,15,253,128,2,11])),saturatedFloatToInt:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,12,1,10,0,67,0,0,0,0,252,0,26,11])),signExtensions:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,65,0,192,26,11])),simd:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),streamingCompilation:()=>(async()=>"compileStreaming"in WebAssembly)(),tailCall:async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,6,1,4,0,18,0,11])),threads:()=>(async e=>{try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),typeReflection:()=>(async()=>"Function"in WebAssembly)()}}));

      function checkWZBrowserSupport() {

        var missingFeatures = [];
        let hasWASMSupport = wasmSupported();
        if (!hasWASMSupport) {
          missingFeatures.push('WebAssembly');
        }

        // Check WebGL 2.0
        const gl = document.createElement('canvas').getContext('webgl2');
        if (!gl) {
          if (typeof WebGL2RenderingContext !== 'undefined') {
            // Browser appears as thought it might support WebGL, but support might be disabled.
            // Try checking browser settings, and updating your OS and/or video card drivers.
            console.log('Your browser appears to possibly support WebGL2, but support may be disabled.\nMake sure WebGL2 is enabled in your browser settings, and try updating your OS and/or graphics drivers.');
            missingFeatures.push('WebGL2 (disabled?)');
          } else {
            console.log('Your browser has no WebGL2 support. Please try updating to the latest version of a supported browser (ex. Chrome, Edge, Firefox, or Safari).');
            missingFeatures.push('WebGL2');
          }
        } else {
          // Initial test for WebGL2 context succeeded
        }
        
        if (missingFeatures.length > 0) {
          displayUnsupportedBrowserMsg(missingFeatures);
          return;
        }

        if (hasWASMSupport) {
          // WebAssembly feature checks
          Promise.all([wasmFeatureDetect.bigInt(), wasmFeatureDetect.bulkMemory(), wasmFeatureDetect.exceptions(), wasmFeatureDetect.saturatedFloatToInt(), wasmFeatureDetect.threads()]).then((values) => {
            if (values.every(element => element === true)) {
              // All required features available
              displayLaunchGameMsg();
              if (isRunningStandalone()) {
                // automatically trigger a run in standalone mode
                startGame();
              }
            } else {
              var missingWASMFeaturesStr = '';
              if (!values[0]) {
                missingFeatures.push('Wasm:BigInt');
              }
              if (!values[1]) {
                missingFeatures.push('Wasm:BulkMemory');
              }
              if (!values[2]) {
                missingFeatures.push('Wasm:Exceptions');
              }
              if (!values[3]) {
                missingFeatures.push('Wasm:FloatToInt');
              }
              if (!values[4]) {
                missingFeatures.push('Wasm:Threads');
              }
              displayUnsupportedBrowserMsg(missingFeatures);
            }
          });
        }
      }
      function wz_everything_is_loaded() {
        wz_restore_launch_options();
        checkWZBrowserSupport();
      }
      function wz_js_handle_app_exit() {
        document.getElementById('emscripten_container').style.display = 'none';
        document.getElementById('post-exit').style.display = 'block';
        document.getElementById('footer').style.display = 'block';
      }
      var everythingLoadedTimer = setInterval(function() {
        if (/loaded|complete/.test(document.readyState)) {
          clearInterval(everythingLoadedTimer);
          wz_everything_is_loaded();
        }
      }, 10);
    </script>
    <script type='text/javascript'>
      var statusElement = document.getElementById('status');
      var progressElement = document.getElementById('progress');
    
      // Monkeypatch WebAssembly downloading to have a progress bar
      // inspired from: https://github.com/WordPress/wordpress-playground/pull/46 (but had to be modified)
      function monkeyPatch(progressFun) {
        const _instantiateStreaming = WebAssembly.instantiateStreaming;
        WebAssembly.instantiateStreaming = (response, ...args) => {
          const file = response.url.substring(
            new URL(response.url).origin.length + 1
          );
          const reportingResponse = new Response(
            new ReadableStream({
              async start(controller) {
                const contentLength = response.headers.get("content-length");
                const total = parseInt(contentLength, 10);
                const reader = response.clone().body.getReader();
                let loaded = 0;
                for (; ;) {
                  const { done, value } = await reader.read();
                  if (done) {
                    progressFun(file, total, total);
                    break;
                  }
                  loaded += value.byteLength;
                  progressFun(file, loaded, total);
                  controller.enqueue(value);
                }
                controller.close();
              }
            },
              {
                status: response.status,
                statusText: response.statusText
              }
            )
          );
          for (const pair of response.headers.entries()) {
            reportingResponse.headers.set(pair[0], pair[1]);
          }

          return _instantiateStreaming(reportingResponse, ...args);
        }
      }
      monkeyPatch((file, done, total) => {
        let percent = ((done/total)*100).toFixed(2);
        let mib = (done/1024**2).toFixed(2);
        statusElement.innerHTML = `Downloading app: ${percent}% (${mib}MiB)`;
        progressElement.value = (done / 1024);
        progressElement.max = (total / 1024);
        progressElement.hidden = false;
      });

      var Module = {
      preRun: [],
      postRun: [],
      print: (function() {
        return function(text) {
        if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
        console.log(text);
        };
      })(),
      canvas: (function() {
        var canvas = document.getElementById('canvas');

        // As a default initial behavior, pop up an alert when webgl context is lost. To make your
        // application robust, you may want to override this behavior before shipping!
        // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
        canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);
      

        return canvas;
      })(),
      setStatus: function(text) {
        if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
        if (text === Module.setStatus.last.text) return;
        var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
        var now = Date.now();
        if (m && now - Module.setStatus.last.time < 30) return; // if this is a progress update, skip it if too soon
        Module.setStatus.last.time = now;
        Module.setStatus.last.text = text;
        if (m) {
          progressElement.value = parseInt(m[2])*100;
          progressElement.max = parseInt(m[4])*100;
          progressElement.hidden = false;
        } else {
          progressElement.value = null;
          progressElement.max = null;
          progressElement.hidden = true;
        }
        statusElement.innerHTML = text;
      },
      totalDependencies: 0,
      monitorRunDependencies: function(left) {
        this.totalDependencies = Math.max(this.totalDependencies, left);
        Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
      }
      };
    
      function wz_pre_run_fixup_canvas() {
        Module.canvas.style.backgroundColor = "black";
      }
    
      Module['preRun'].push(wz_pre_run_fixup_canvas);
      Module.arguments = ['--configdir=/warzone2100'+wz_js_get_config_dir_suffix()];
      if (WZ_VIDEO_SEQUENCES_BASE_URL !== null) {
        Module.arguments.push('--videourl='+WZ_VIDEO_SEQUENCES_BASE_URL);
      }
      window.onerror = function(event) {
        Module.setStatus('Exception thrown, see JavaScript console');
        Module.setStatus = function(text) {
          if (text) console.log('[post-exception status] ' + text);
        };
        if (!Module.hasOwnProperty('calledRun') || !Module.calledRun) {
          wz_display_loading_error(event);
        }
      };
      
      Module['locateFile'] = function(path, prefix) {
        // If it's a data file, and a custom data files host is specified
        if (path.endsWith(".data")) {
          // Shared data files
          // - music
          if (path === 'warzone2100-music.data') {
            let musicDataURL = WZ_MUSIC_BASE_URL + path;
            console.log(musicDataURL);
            return musicDataURL;
          }
          // - terrain_overrides
          if (path.startsWith('warzone2100-terrain-')) {
            let terrainDataURL = WZ_DATA_TERRAIN_BASE_URL + path;
            console.log(terrainDataURL);
            return terrainDataURL;
          }
          
          if (WZ_DATA_FILES_URL_HOST !== null) {
            // Regular build-specific data files
            // Prefix is not guaranteed to be set for these by the preloader, so construct the path manually
            var subPath = WZ_DATA_FILES_URL_SUBDIR;
            if (!subPath.endsWith('/')) { subPath += '/'; }
            subPath += path;
            var dataURL = new URL(subPath, WZ_DATA_FILES_URL_HOST);
            console.log(dataURL.toString());
          }
        }
        // otherwise, use the default, the prefix (JS file's dir) + the path
        return prefix + path;
      }
      
      function wz_detect_platform() {
        
        let platformValue = (function() {
          // Modern method, accurate, but only works on Chromium browsers (currently)
          if (typeof navigator.userAgentData !== 'undefined' && navigator.userAgentData != null) {
              return navigator.userAgentData.platform;
          }
          // Deprecated, but still available in many cases
          if (typeof navigator.platform !== 'undefined') {
              if (typeof navigator.userAgent !== 'undefined' && /android/.test(navigator.userAgent.toLowerCase())) {
                  // Android device navigator.platform is often set as 'linux', so use userAgent detection
                  return 'android';
              }
              return navigator.platform;
          }
          return 'unknown';
        })().toLowerCase();
        
        let macosPlatforms = /(macintosh|macintel|macos)/i;
        let iosPlatforms = /(iphone|ipad)/i;
        let windowsPlatforms = /(win32|win64|windows)/i;
        
        var result = 'unknown';
        if (macosPlatforms.test(platformValue)) {
          result = "macos";
        } else if (iosPlatforms.test(platformValue)) {
          result = "ios";
        } else if (windowsPlatforms.test(platformValue)) {
          result = "windows";
        } else if (/android/.test(platformValue)) {
          result = "android";
        } else if (/linux/.test(platformValue)) {
          result = "linux";
        }
        return result;
      }
      
      // Best-effort attempt to detect whether the desktop full version might be available for the current platform
      let platform = wz_detect_platform();
      if (/(windows|macos|linux)/.test(platform)) {
        document.getElementById('full-version-footer-notice').classList.remove('hide-on-standalone');
      }
  </script>
  {{{ SCRIPT }}}
  </body>
</html>
